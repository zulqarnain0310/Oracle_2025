--------------------------------------------------------
--  DDL for Procedure CONTEXCSSINCEDTDEBIT_21082024
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" /*==============================================
 AUTHER : TRILOKI SHANKER KHANNA
 CREATE DATE : 26-12-2019
 MODIFY DATE : 26-12-2019
 DESCRIPTION : INSERT DATA PRO.ContExcsSinceDtDebit
 --EXEC PRO.ContExcsSinceDtDebit

 ================================================*/
--BEGIN
 --DECLARE  @vEffectivefrom  Int SET @vEffectiveFrom=(SELECT TimeKey FROM [dbo].Automate_Advances WHERE EXT_FLG='Y')
 --DECLARE @TimeKey  Int SET @TimeKey=(SELECT TimeKey FROM [dbo].Automate_Advances WHERE EXT_FLG='Y')
 --DECLARE @DATE AS DATE =(SELECT Date FROM [dbo].Automate_Advances WHERE EXT_FLG='Y')
 --IF OBJECT_ID('TEMPDB..#ContExcsSinceDtDebitAccountCal') IS NOT NULL
 --   DROP TABLE #ContExcsSinceDtDebitAccountCal
 --   SELECT CustomerAcID INTO #ContExcsSinceDtDebitAccountCal  FROM 
 --		 DBO.DPDAILYFULL  A
 --	INNER JOIN [dbo].[AdvAcBasicDetail] B	ON A.CID=B.SystemACID
 --	inner  JOIN dbo.DIMGL GL	ON A.[PRINCIPAL GL]= GL.GLCode AND GL.EffectiveFromTimeKey<=@TimeKey AND GL.EffectiveToTimeKey>=@TimeKeY
 --	WHERE A.GRP in ('DDA','SAV')and CASE WHEN A.BAL='NULL'  OR  A.BAL='' THEN NULL ELSE (CAST(ISNULL(A.BAL,0) AS decimal(18,2))) END <0
 --	EXCEPT
 --   SELECT CustomerAcID FROM Pro.ContExcsSinceDtDebitAccountCal where Effectivetotimekey=49999
 --   INSERT INTO Pro.ContExcsSinceDtDebitAccountCal
 --   (
 --	    CustomerAcID
 --		,AccountEntityId
 --		,SanctionAmt
 --		,SanctionDt
 --		,Balance
 --		,DrawingPower
 --		,ContExcsSinceDebitDt
 --		,EffectiveFromTimeKey
 --		,EffectiveToTimeKey
 --   )
 --SELECT 
 -- B.CustomerAcID AS CustomerAcID
 --,B.AccountEntityId AS AccountEntityId
 --,B.OriginalLimit AS SanctionAmt
 --,B.OriginalLimitDt  AS  SanctionDt
 --,CASE WHEN A.BAL='NULL'  OR  A.BAL='' THEN NULL ELSE (CAST(ISNULL(A.BAL,0) AS decimal(18,2))) END*-1 AS  Balance
 --,B.ORIGINALLIMIT  AS DrawingPower
 --,@DATE AS ContExcsSinceDebitDt
 --,@TimeKey AS EffectiveFromTimeKey
 --,49999 AS  EffectiveToTimeKey
 --FROM #ContExcsSinceDtDebitAccountCal D INNER JOIN
 -- DBO.DPDAILYFULL A ON D.CustomerACID=A.CID INNER JOIN [dbo].[AdvAcBasicDetail] B ON A.CID=B.SystemACID
 -- inner  JOIN dbo.DIMGL GL	ON A.[PRINCIPAL GL]= GL.GLCode AND GL.EffectiveFromTimeKey<=@TimeKey AND GL.EffectiveToTimeKey>=@TimeKeY
 --WHERE A.GRP in ('DDA','SAV')and CASE WHEN A.BAL='NULL'  OR  A.BAL='' THEN NULL ELSE (CAST(ISNULL(A.BAL,0) AS decimal(18,2))) END <0
 -- IF OBJECT_ID('TEMPDB..#ContExcsSinceDtDebitAccountCalEXP') IS NOT NULL
 --   DROP TABLE #ContExcsSinceDtDebitAccountCalEXP
 --   SELECT CustomerAcID INTO #ContExcsSinceDtDebitAccountCalEXP  FROM 
 --		 DBO.DPDAILYFULL A
 --	INNER JOIN [dbo].[AdvAcBasicDetail] B	ON A.CID=B.SystemACID
 -- inner  JOIN dbo.DIMGL GL	ON A.[PRINCIPAL GL]= GL.GLCode AND GL.EffectiveFromTimeKey<=@TimeKey AND GL.EffectiveToTimeKey>=@TimeKeY
 --WHERE A.GRP in ('DDA','SAV')and CASE WHEN A.BAL='NULL'  OR  A.BAL='' THEN NULL ELSE (CAST(ISNULL(A.BAL,0) AS decimal(18,2))) END <0
 ----/*------EXPIRE DATA FOR ---------------------*/
 --UPDATE A SET A.EffectiveToTimekey=@TimeKey-1
 --FROM Pro.ContExcsSinceDtDebitAccountCal A LEFT OUTER JOIN  
 --(
 --select   A.CustomerAcID  from Pro.ContExcsSinceDtDebitAccountCal a inner join #ContExcsSinceDtDebitAccountCalEXP b
 -- on a.CustomerAcID=b.CustomerAcID 
 --) C 
 --ON A.CustomerAcID=C.CustomerAcID
 --WHERE C.CustomerAcID IS NULL AND A.EffectiveToTimekey=49999
 -- DROP TABLE #ContExcsSinceDtDebitAccountCal
 -- DROP TABLE #ContExcsSinceDtDebitAccountCalEXP
 --END

AS

BEGIN

   NULL;

EXCEPTION WHEN OTHERS THEN utils.handleerror(SQLCODE,SQLERRM);
END;

/

  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "ROLE_LOCAL_RBL_MISDB_PROD_ORACLE";
  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "PREMOC_RBL_MISDB_PROD";
  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "QPI_RBL_MISDB_PROD";
  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "ALERT_RBL_MISDB_PROD";
  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "DWH_RBL_MISDB_PROD";
  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "D2KMNTR_RBL_MISDB_PROD";
  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "CURDAT_RBL_MISDB_PROD";
  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "BS_RBL_MISDB_PROD";
  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "ACL_RBL_MISDB_PROD";
  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "ETL_MAIN_RBL_MISDB_PROD";
  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "RBL_MISDB_PROD";
  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "DATAUPLOAD_RBL_MISDB_PROD";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "ROLE_LOCAL_RBL_MISDB_PROD_ORACLE";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "PREMOC_RBL_MISDB_PROD";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "QPI_RBL_MISDB_PROD";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "ALERT_RBL_MISDB_PROD";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "DWH_RBL_MISDB_PROD";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "D2KMNTR_RBL_MISDB_PROD";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "CURDAT_RBL_MISDB_PROD";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "BS_RBL_MISDB_PROD";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "ACL_RBL_MISDB_PROD";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "ETL_MAIN_RBL_MISDB_PROD";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "RBL_MISDB_PROD";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "DATAUPLOAD_RBL_MISDB_PROD";
  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "ROLE_ALL_DB";
  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "CC_CDR_RBL_STGDB";
  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "RBL_BI_RBL_STGDB";
  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "BSG_READ_RBL_STGDB";
  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "STD_FIN_RBL_STGDB";
  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "RBL_STGDB";
  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "ETL_TEMP_RBL_TEMPDB";
  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "RBL_TEMPDB";
  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "STG_FIN_RBL_STGDB";
  GRANT EXECUTE ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "ADF_CDR_RBL_STGDB";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "ROLE_ALL_DB";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "CC_CDR_RBL_STGDB";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "RBL_BI_RBL_STGDB";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "BSG_READ_RBL_STGDB";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "STD_FIN_RBL_STGDB";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "RBL_STGDB";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "ETL_TEMP_RBL_TEMPDB";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "RBL_TEMPDB";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "STG_FIN_RBL_STGDB";
  GRANT DEBUG ON "MAIN_PRO"."CONTEXCSSINCEDTDEBIT_21082024" TO "ADF_CDR_RBL_STGDB";
