--------------------------------------------------------
--  DDL for Function REMOVEINVALIDXMLCHARACTERS
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" 
(
  iv_InputString IN NVARCHAR2
)
RETURN NVARCHAR2
AS
   v_InputString NVARCHAR2(4000) := iv_InputString;

BEGIN
   IF v_InputString IS NOT NULL THEN
    DECLARE
      v_Counter NUMBER(10,0);
      v_TestString NVARCHAR2(40);

   BEGIN
      v_TestString := '%[' || NCHR(0) || NCHR(1) || NCHR(2) || NCHR(3) || NCHR(4) || NCHR(5) || NCHR(6) || NCHR(7) || NCHR(8) || NCHR(11) || NCHR(12) || NCHR(14) || NCHR(15) || NCHR(16) || NCHR(17) || NCHR(18) || NCHR(19) || NCHR(20) || NCHR(21) || NCHR(22) || NCHR(23) || NCHR(24) || NCHR(25) || NCHR(26) || NCHR(27) || NCHR(28) || NCHR(29) || NCHR(30) || NCHR(31) || ']%' ;
      v_Counter := utils.patindex(v_TestString, v_InputString) ;
      WHILE v_Counter <> 0 
      LOOP 

         BEGIN
            v_InputString := utils.stuff(v_InputString, v_Counter, 1, NCHR(164)) ;
            v_Counter := utils.patindex(v_TestString, v_InputString) ;

         END;
      END LOOP;

   END;
   END IF;
   RETURN (v_InputString);

EXCEPTION WHEN OTHERS THEN utils.handleerror(SQLCODE,SQLERRM);
END;

/

  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "ROLE_LOCAL_RBL_MISDB_PROD_ORACLE";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "PREMOC_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "QPI_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "ALERT_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "DWH_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "MAIN_PRO";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "D2KMNTR_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "CURDAT_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "BS_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "ACL_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "ETL_MAIN_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "DATAUPLOAD_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "ROLE_LOCAL_RBL_MISDB_PROD_ORACLE";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "PREMOC_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "QPI_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "ALERT_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "DWH_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "MAIN_PRO";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "D2KMNTR_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "CURDAT_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "BS_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "ACL_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "ETL_MAIN_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "DATAUPLOAD_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "ROLE_ALL_DB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "CC_CDR_RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "RBL_BI_RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "BSG_READ_RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "STD_FIN_RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "ETL_TEMP_RBL_TEMPDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "RBL_TEMPDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "STG_FIN_RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "ADF_CDR_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "ROLE_ALL_DB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "CC_CDR_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "RBL_BI_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "BSG_READ_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "STD_FIN_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "ETL_TEMP_RBL_TEMPDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "RBL_TEMPDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "STG_FIN_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."REMOVEINVALIDXMLCHARACTERS" TO "ADF_CDR_RBL_STGDB";
