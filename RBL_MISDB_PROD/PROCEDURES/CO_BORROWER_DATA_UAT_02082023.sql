--------------------------------------------------------
--  DDL for Procedure CO_BORROWER_DATA_UAT_02082023
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" 
AS
   v_cursor SYS_REFCURSOR;

BEGIN

   DELETE FROM tt_leftaccounts_6;
   UTILS.IDENTITY_RESET('tt_leftaccounts_6');

   INSERT INTO tt_leftaccounts_6 ( 
   	SELECT UCIF_ID ,
           CustomerAcID 
   	  FROM PRO_RBL_MISDB_PROD.AccountCal_Main 
   	 WHERE  UCIF_ID IN ( SELECT ucic 
                         FROM CO_BORROWER_DATA_UAT  )

   	MINUS 
   	SELECT ucic ,
           account_no 
   	  FROM CO_BORROWER_DATA_UAT  );
   OPEN  v_cursor FOR
      SELECT * 
        FROM CO_BORROWER_DATA_UAT  ;
      DBMS_SQL.RETURN_RESULT(v_cursor);
   --select top 1 * from CO_BORROWER_DATA_UAT
   INSERT INTO CO_BORROWER_DATA_UAT
     ( SELECT D.SchemeType ,
              A.ProductCode ,
              A.ActSegmentCode ,
              A.CustomerAcID ,
              A.RefCustomerID ,
              E.CustomerName ,
              'MAIN' customer_type  ,
              A.UCIF_ID ,
              A.PrincOutstd ,
              A.RefCustomerID ,
              NULL Acct_Cust_Code  ,
              NULL CoBorr_CustID  ,
              A.FinalAssetClassAlt_Key ,
              A.FinalAssetClassAlt_Key ,
              NULL ,
              A.Balance ,
              PrincOutStd ,
              TotalProvision ,
              SourceName 
       FROM PRO_RBL_MISDB_PROD.AccountCal_Main A
              JOIN tt_leftaccounts_6 B   ON A.UCIF_ID = B.UCIF_ID
              AND A.CustomerAcID = B.CustomerAcID
              LEFT JOIN DIMSOURCEDB C   ON A.SourceAlt_Key = C.SourceAlt_Key
              AND C.EffectiveToTimeKey = 49999
              LEFT JOIN DimProduct D   ON A.ProductCode = D.ProductCode
              AND D.EffectiveToTimeKey = 49999
              LEFT JOIN CurDat_RBL_MISDB_PROD.CustomerBasicDetail E   ON A.CustomerEntityID = E.CustomerEntityId );

EXCEPTION WHEN OTHERS THEN utils.handleerror(SQLCODE,SQLERRM);
END;

/

  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "ROLE_LOCAL_RBL_MISDB_PROD_ORACLE";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "PREMOC_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "QPI_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "ALERT_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "DWH_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "MAIN_PRO";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "D2KMNTR_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "CURDAT_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "BS_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "ACL_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "ETL_MAIN_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "DATAUPLOAD_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "ROLE_LOCAL_RBL_MISDB_PROD_ORACLE";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "PREMOC_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "QPI_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "ALERT_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "DWH_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "MAIN_PRO";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "D2KMNTR_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "CURDAT_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "BS_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "ACL_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "ETL_MAIN_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "DATAUPLOAD_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "ROLE_ALL_DB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "CC_CDR_RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "RBL_BI_RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "BSG_READ_RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "STD_FIN_RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "ETL_TEMP_RBL_TEMPDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "RBL_TEMPDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "STG_FIN_RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "ADF_CDR_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "ROLE_ALL_DB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "CC_CDR_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "RBL_BI_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "BSG_READ_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "STD_FIN_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "ETL_TEMP_RBL_TEMPDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "RBL_TEMPDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "STG_FIN_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."CO_BORROWER_DATA_UAT_02082023" TO "ADF_CDR_RBL_STGDB";
