--------------------------------------------------------
--  DDL for Procedure RBLETLCOUNTRECORDS
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" 
AS
   v_cursor SYS_REFCURSOR;
   v_Date VARCHAR2(200) := ( SELECT Date_ 
     FROM Automate_Advances 
    WHERE  Ext_flg = 'Y' );
   v_Timekey NUMBER(10,0) := ( SELECT Timekey 
     FROM Automate_Advances 
    WHERE  Ext_flg = 'Y' );

BEGIN

   DBMS_OUTPUT.PUT_LINE('dwh count');
   DWH_STG.dwhcount() ;
   DBMS_OUTPUT.PUT_LINE('UCIC Count');
   OPEN  v_cursor FOR
      SELECT 'FinacleUCIC_Data' SourceName  ,
             COUNT(*)  NullCounts  
        FROM dwh_DWH_STG.account_data_finacle 
       WHERE  ucic IS NULL
      UNION 
      SELECT 'GanasevaUCIC_Data' ,
             COUNT(*)  
        FROM dwh_DWH_STG.account_data_ganaseva 
       WHERE  ucic IS NULL
      UNION 
      SELECT 'IndusUCIC_Data' ,
             COUNT(*)  
        FROM dwh_DWH_STG.accounts_data 
       WHERE  ucic IS NULL
      UNION 
      SELECT 'ECBFUCIC_Data' ,
             COUNT(*)  
        FROM dwh_DWH_STG.account_data_ecbf 
       WHERE  ucic IS NULL
      UNION 
      SELECT 'MIFINUCIC_Data' ,
             COUNT(*)  
        FROM dwh_DWH_STG.accounts_data_mifin 
       WHERE  ucic IS NULL ;
      DBMS_SQL.RETURN_RESULT(v_cursor);
   --UNION
   --select 'VisionPlusUCIC_Data',count(*) from DWH_STG.dwh.account_data_visionplus where ucic is NULL
   DBMS_OUTPUT.PUT_LINE('ACLOutput');
   OPEN  v_cursor FOR
      SELECT v_Date DateofData  ,
             'ACL_NPA_Data' TableName  ,
             COUNT(1)  COUNT  
        FROM ACL_NPA_DATA 
       WHERE  UTILS.CONVERT_TO_VARCHAR2(Process_Date,200,p_style=>105) IN ( SELECT UTILS.CONVERT_TO_VARCHAR2(Date_,200,p_style=>105) 
                                                                            FROM Automate_Advances 
                                                                             WHERE  Ext_flg = 'Y' )
    ;
      DBMS_SQL.RETURN_RESULT(v_cursor);
   OPEN  v_cursor FOR
      SELECT v_Date DateofData  ,
             'ACL_UPG_Data' TableName  ,
             COUNT(1)  COUNT  
        FROM ACL_UPG_DATA 
       WHERE  UTILS.CONVERT_TO_VARCHAR2(Process_Date,200,p_style=>105) IN ( SELECT UTILS.CONVERT_TO_VARCHAR2(Date_,200,p_style=>105) 
                                                                            FROM Automate_Advances 
                                                                             WHERE  Ext_flg = 'Y' )
    ;
      DBMS_SQL.RETURN_RESULT(v_cursor);
   OPEN  v_cursor FOR
      SELECT v_Date DateofData  ,
             'Investment_Data' TableName  ,
             COUNT(1)  COUNT  
        FROM INVESTMENT_DATA 
       WHERE  UTILS.CONVERT_TO_VARCHAR2(Process_Date,200,p_style=>105) IN ( SELECT UTILS.CONVERT_TO_VARCHAR2(Date_,200,p_style=>105) 
                                                                            FROM Automate_Advances 
                                                                             WHERE  Ext_flg = 'Y' )
    ;
      DBMS_SQL.RETURN_RESULT(v_cursor);

EXCEPTION WHEN OTHERS THEN utils.handleerror(SQLCODE,SQLERRM);
END;

/

  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "ROLE_LOCAL_RBL_MISDB_PROD_ORACLE";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "PREMOC_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "QPI_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "ALERT_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "DWH_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "MAIN_PRO";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "D2KMNTR_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "CURDAT_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "BS_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "ACL_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "ETL_MAIN_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "DATAUPLOAD_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "ROLE_LOCAL_RBL_MISDB_PROD_ORACLE";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "PREMOC_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "QPI_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "ALERT_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "DWH_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "MAIN_PRO";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "D2KMNTR_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "CURDAT_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "BS_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "ACL_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "ETL_MAIN_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "DATAUPLOAD_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "ROLE_ALL_DB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "CC_CDR_RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "RBL_BI_RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "BSG_READ_RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "STD_FIN_RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "ETL_TEMP_RBL_TEMPDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "RBL_TEMPDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "STG_FIN_RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "ADF_CDR_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "ROLE_ALL_DB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "CC_CDR_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "RBL_BI_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "BSG_READ_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "STD_FIN_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "ETL_TEMP_RBL_TEMPDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "RBL_TEMPDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "STG_FIN_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."RBLETLCOUNTRECORDS" TO "ADF_CDR_RBL_STGDB";
