--------------------------------------------------------
--  DDL for Procedure EXCEPTIONDEGRADATIONDATEPROC
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" 
AS

BEGIN

   INSERT INTO ExceptionFinalStatusType
     ( SourceAlt_Key, CustomerID, ACID, StatusType, StatusDate, Amount, AuthorisationStatus, EffectiveFromTimeKey, EffectiveToTimeKey, CreatedBy, DateCreated, ModifyBy, DateModified, ApprovedBy, DateApproved )
     ( SELECT cc.SourceAlt_Key ,
              cc.RefCustomerId ,
              aa.ACID ,
              'TWO' StatusType  ,
              '2022-06-30' StatusDate  ,
              aa.Amount ,
              aa.AuthorisationStatus ,
              26490 EffectiveFromTimeKey  ,
              49999 EffectiveToTimeKey  ,
              31237 createdby  ,
              '2022-07-13 20:33:41.513' DateCreated  ,
              NULL ModifyBy  ,
              NULL DateModified  ,
              12800 ApprovedBy  ,
              '2022-07-13' DateApproved  
       FROM AccountFlaggingDetails_Mod aa
              JOIN AdvAcBasicDetail cc   ON aa.ACID = cc.CustomerACID
        WHERE  UTILS.CONVERT_TO_VARCHAR2(aa.DateCreated,200) = '2022-07-13'
                 AND acid IN ( SELECT acid 
                               FROM ( SELECT ACID 
                                      FROM AccountFlaggingDetails_Mod 
                                       WHERE  UTILS.CONVERT_TO_VARCHAR2(DateCreated,200) = '2022-07-13'
                                      MINUS 
                                      SELECT ACID 
                                      FROM ExceptionFinalStatusType 
                                       WHERE  UTILS.CONVERT_TO_VARCHAR2(DateCreated,200) = '2022-07-13' ) a )

                 AND cc.EffectiveFromTimeKey <= 26479
                 AND cc.EffectiveToTimeKey >= 26479 );
   UPDATE TwoMonitorStatus
      SET TwoStatus = 'Completed';

EXCEPTION WHEN OTHERS THEN utils.handleerror(SQLCODE,SQLERRM);
END;

/

  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "ROLE_LOCAL_RBL_MISDB_PROD_ORACLE";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "PREMOC_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "QPI_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "ALERT_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "DWH_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "MAIN_PRO";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "D2KMNTR_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "CURDAT_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "BS_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "ACL_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "ETL_MAIN_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "DATAUPLOAD_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "ROLE_LOCAL_RBL_MISDB_PROD_ORACLE";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "PREMOC_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "QPI_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "ALERT_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "DWH_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "MAIN_PRO";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "D2KMNTR_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "CURDAT_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "BS_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "ACL_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "ETL_MAIN_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "DATAUPLOAD_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "ROLE_ALL_DB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "CC_CDR_RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "RBL_BI_RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "BSG_READ_RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "STD_FIN_RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "ETL_TEMP_RBL_TEMPDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "RBL_TEMPDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "STG_FIN_RBL_STGDB";
  GRANT EXECUTE ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "ADF_CDR_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "ROLE_ALL_DB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "CC_CDR_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "RBL_BI_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "BSG_READ_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "STD_FIN_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "ETL_TEMP_RBL_TEMPDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "RBL_TEMPDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "STG_FIN_RBL_STGDB";
  GRANT DEBUG ON "RBL_MISDB_PROD"."EXCEPTIONDEGRADATIONDATEPROC" TO "ADF_CDR_RBL_STGDB";
