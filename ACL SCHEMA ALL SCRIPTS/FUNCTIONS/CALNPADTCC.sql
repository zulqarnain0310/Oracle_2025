--------------------------------------------------------
--  DDL for Function CALNPADTCC
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "ACL_RBL_MISDB_PROD"."CALNPADTCC" 
-- =============================================
 -- Author:		<Madhur Nagar>
 -- Create date: <21/04/2011>
 -- Description:	<Calculation of minimum NPA DATE IN CC>
 -- Modified by: Shivendra Kumar Yadav
 -- =============================================

(
  v_Timekey IN NUMBER,
  v_DtReviewDeg IN VARCHAR2,
  v_DtStockDeg IN VARCHAR2,
  v_DtConExcessDeg IN VARCHAR2,
  v_CADDegDt IN VARCHAR2,
  v_DtLastCrDeg IN VARCHAR2,
  v_ODDtDeg IN VARCHAR2
)
RETURN DATE
AS
   v_NPADt VARCHAR2(200);
   v_AssetClassificationDt VARCHAR2(200);
--WITH ENCRYPTION

BEGIN
   SELECT Date_ 

     INTO v_AssetClassificationDt
     FROM RBL_MISDB_PROD.SysDayMatrix 
    WHERE  TimeKey = v_Timekey;
   SELECT MIN(Dt)  

     INTO v_NPADt
     FROM ( SELECT v_DtReviewDeg Dt  
              FROM DUAL 
            UNION ALL 
            SELECT v_DtStockDeg Dt  
              FROM DUAL 
            UNION ALL 
            SELECT v_DtConExcessDeg Dt  
              FROM DUAL 
            UNION ALL 
            SELECT v_CADDegDt Dt  
              FROM DUAL 
            UNION ALL 
            SELECT v_DtLastCrDeg 
              FROM DUAL 
            UNION ALL 
            SELECT v_ODDtDeg 
              FROM DUAL 
            UNION ALL 
            SELECT v_AssetClassificationDt Dt  
              FROM DUAL  ) Dt;
   /*
   	   --DECLARETION PART
   		DECLARE @NPADt smalldatetime,@dtTest smalldatetime,@dtTestNPA smalldatetime

   		--SET DEFAULT NULL
   		SELECT @NPADt=NULL


   		--Calculate Minimum NPA Date
   		IF @CADDegDt IS NOT NULL
   		BEGIN
   			If @DtReviewDeg <= @DtStockDeg 
   				BEGIN
   					SELECT @dtTest = @DtReviewDeg
   					SELECT @dtTestNPA = @dtTest
   				END 
   			Else
   				BEGIN
   					SELECT @dtTest = @DtStockDeg
   					SELECT @dtTestNPA = @dtTest
   				END

   			If @dtTest <= @DtConExcessDeg 
   				BEGIN
   					SELECT @dtTest = @dtTest
   					SELECT @dtTestNPA = @dtTest
   				END
   			Else
   				BEGIN
   					SELECT @dtTest = @DtConExcessDeg
   					SELECT @dtTestNPA = @dtTest
   				END 

   			If @dtTest <= @CADDegDt
   				BEGIN 
   					SELECT @dtTest = @dtTest
   					SELECT @dtTestNPA = @dtTest
   				END
   			Else
   				BEGIN
   					SELECT @dtTest = @CADDegDt
   					SELECT @dtTestNPA = @dtTest
   				END

   			 SELECT @NPADt=@dtTest
          END

   	   */
   RETURN v_NPADt;

EXCEPTION WHEN OTHERS THEN utils.handleerror(SQLCODE,SQLERRM);
END;

/

  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "ROLE_LOCAL_RBL_MISDB_PROD_ORACLE";
  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "PREMOC_RBL_MISDB_PROD";
  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "QPI_RBL_MISDB_PROD";
  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "ALERT_RBL_MISDB_PROD";
  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "DWH_RBL_MISDB_PROD";
  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "MAIN_PRO";
  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "D2KMNTR_RBL_MISDB_PROD";
  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "CURDAT_RBL_MISDB_PROD";
  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "BS_RBL_MISDB_PROD";
  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "ETL_MAIN_RBL_MISDB_PROD";
  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "RBL_MISDB_PROD";
  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "DATAUPLOAD_RBL_MISDB_PROD";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "ROLE_LOCAL_RBL_MISDB_PROD_ORACLE";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "PREMOC_RBL_MISDB_PROD";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "QPI_RBL_MISDB_PROD";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "ALERT_RBL_MISDB_PROD";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "DWH_RBL_MISDB_PROD";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "MAIN_PRO";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "D2KMNTR_RBL_MISDB_PROD";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "CURDAT_RBL_MISDB_PROD";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "BS_RBL_MISDB_PROD";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "ETL_MAIN_RBL_MISDB_PROD";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "RBL_MISDB_PROD";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "DATAUPLOAD_RBL_MISDB_PROD";
  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "ROLE_ALL_DB";
  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "CC_CDR_RBL_STGDB";
  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "RBL_BI_RBL_STGDB";
  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "BSG_READ_RBL_STGDB";
  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "STD_FIN_RBL_STGDB";
  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "RBL_STGDB";
  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "ETL_TEMP_RBL_TEMPDB";
  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "RBL_TEMPDB";
  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "STG_FIN_RBL_STGDB";
  GRANT EXECUTE ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "ADF_CDR_RBL_STGDB";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "ROLE_ALL_DB";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "CC_CDR_RBL_STGDB";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "RBL_BI_RBL_STGDB";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "BSG_READ_RBL_STGDB";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "STD_FIN_RBL_STGDB";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "RBL_STGDB";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "ETL_TEMP_RBL_TEMPDB";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "RBL_TEMPDB";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "STG_FIN_RBL_STGDB";
  GRANT DEBUG ON "ACL_RBL_MISDB_PROD"."CALNPADTCC" TO "ADF_CDR_RBL_STGDB";
