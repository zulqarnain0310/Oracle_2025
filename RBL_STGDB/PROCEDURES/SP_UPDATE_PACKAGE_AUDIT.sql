--------------------------------------------------------
--  DDL for Procedure SP_UPDATE_PACKAGE_AUDIT
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" 
AS
   --Alter table Package_AUDIT
   --add DATE_OF_DATA Date 
   v_DateOfData VARCHAR2(200) ;

BEGIN

   SELECT DISTINCT date_of_data INTO v_DateOfData 
     FROM DWH_STG.account_data_finacle;

   UPDATE RBL_STGDB.Package_AUDIT
      SET DATE_OF_DATA = v_DateOfData
    WHERE  Execution_date > '2024-01-14'
     AND date_of_data IS NULL;--if @DATE_OF_DATA=(Select DATE_OF_DATA from rbl_stgdb..Package_AUDIT where DATE_OF_DATA=@DATE_OF_DATA)
   --Begin
   --Insert into Package_AUDIT_MOD(Execution_date,DataBaseName,PackageName,TableName,ExecutionStartTime,ExecutionEndTime
   --,TimeDuration_Sec,ExecutionStatus,DATE_OF_DATA)
   --select Execution_date,DataBaseName,PackageName,TableName,ExecutionStartTime,ExecutionEndTime
   --,TimeDuration_Sec,ExecutionStatus,DATE_OF_DATA from Package_AUDIT WHERE DATE_OF_DATA>=@DATE_OF_DATA
   --Delete From Package_AUDIT WHERE DATE_OF_DATA>=@DATE_OF_DATA
   --End

EXCEPTION WHEN NO_DATA_FOUND THEN DBMS_OUTPUT.PUT_LINE('NO DATA FOUND');
            WHEN OTHERS THEN utils.handleerror(SQLCODE,SQLERRM);
END;

/

  GRANT EXECUTE ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "ROLE_ALL_DB";
  GRANT EXECUTE ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "CC_CDR_RBL_STGDB";
  GRANT EXECUTE ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "MAIN_PRO";
  GRANT EXECUTE ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "RBL_BI_RBL_STGDB";
  GRANT EXECUTE ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "ALERT_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "ACL_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "D2KMNTR_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "QPI_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "CURDAT_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "PREMOC_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "BSG_READ_RBL_STGDB";
  GRANT EXECUTE ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "STD_FIN_RBL_STGDB";
  GRANT EXECUTE ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "BS_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "DWH_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "ETL_TEMP_RBL_TEMPDB";
  GRANT EXECUTE ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "RBL_TEMPDB";
  GRANT EXECUTE ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "ETL_MAIN_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "STG_FIN_RBL_STGDB";
  GRANT EXECUTE ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "DATAUPLOAD_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "ADF_CDR_RBL_STGDB";
  GRANT DEBUG ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "ROLE_ALL_DB";
  GRANT DEBUG ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "CC_CDR_RBL_STGDB";
  GRANT DEBUG ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "MAIN_PRO";
  GRANT DEBUG ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "RBL_BI_RBL_STGDB";
  GRANT DEBUG ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "ALERT_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "ACL_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "D2KMNTR_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "QPI_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "CURDAT_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "PREMOC_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "BSG_READ_RBL_STGDB";
  GRANT DEBUG ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "STD_FIN_RBL_STGDB";
  GRANT DEBUG ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "BS_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "DWH_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "ETL_TEMP_RBL_TEMPDB";
  GRANT DEBUG ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "RBL_TEMPDB";
  GRANT DEBUG ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "ETL_MAIN_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "STG_FIN_RBL_STGDB";
  GRANT DEBUG ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "DATAUPLOAD_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."SP_UPDATE_PACKAGE_AUDIT" TO "ADF_CDR_RBL_STGDB";
