--------------------------------------------------------
--  DDL for Procedure UPDATEAUTOMATE_ADVANCES
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" 
AS

BEGIN

   UPDATE RBL_STGDB.AUTOMATE_ADVANCES
      SET EXT_FLG = 'N'
    WHERE  EXT_FLG = 'Y';
   UPDATE RBL_MISDB_PROD.AUTOMATE_ADVANCES
      SET EXT_FLG = 'N'
    WHERE  EXT_FLG = 'Y';
   UPDATE RBL_MISDB_PROD.EXT_DATE_MISDB
      SET EXTFLAG = 'U'
    WHERE  EXTFLAG = 'Y';
   UPDATE RBL_MISDB_PROD.SYSDATAMATRIX
      SET CURRENTSTATUS = 'U'
    WHERE  CURRENTSTATUS = 'C';
   UPDATE RBL_MISDB_PROD.EXT_DATE_MISDB
      SET EXTFLAG = 'Y'
    WHERE  EXTDATE IN ( SELECT UTILS.CONVERT_TO_VARCHAR2(SYSDATE - 1,200) -------EXTRATION DATE
                          FROM DUAL  )
   ;
   MERGE INTO RBL_MISDB_PROD.SYSDATAMATRIX 
   USING (SELECT RBL_MISDB_PROD.SYSDATAMATRIX.ROWID row_id, 'C'
   FROM RBL_MISDB_PROD.SYSDATAMATRIX 
          JOIN RBL_MISDB_PROD.EXT_DATE_MISDB    ON RBL_MISDB_PROD.SYSDATAMATRIX.TIMEKEY = RBL_MISDB_PROD.EXT_DATE_MISDB.TIMEKEY 
    WHERE EXTFLAG = 'Y') src
   ON ( RBL_MISDB_PROD.SYSDATAMATRIX.ROWID = src.row_id )
   WHEN MATCHED THEN UPDATE SET CURRENTSTATUS = 'C';-------EXTRATION DATE
   MERGE INTO RBL_STGDB.AUTOMATE_ADVANCES 
   USING (SELECT RBL_STGDB.AUTOMATE_ADVANCES.ROWID row_id, 'Y'
   FROM RBL_STGDB.AUTOMATE_ADVANCES 
          JOIN RBL_MISDB_PROD.EXT_DATE_MISDB    ON RBL_STGDB.AUTOMATE_ADVANCES.Timekey = RBL_MISDB_PROD.EXT_DATE_MISDB.Timekey 
    WHERE EXTFLAG = 'Y') src
   ON ( RBL_STGDB.AUTOMATE_ADVANCES.ROWID = src.row_id )
   WHEN MATCHED THEN UPDATE SET EXT_FLG = 'Y';
   MERGE INTO RBL_MISDB_PROD.AUTOMATE_ADVANCES 
   USING (SELECT RBL_MISDB_PROD.AUTOMATE_ADVANCES.ROWID row_id, 'Y'
   FROM RBL_MISDB_PROD.AUTOMATE_ADVANCES 
          JOIN RBL_MISDB_PROD.EXT_DATE_MISDB    ON RBL_MISDB_PROD.AUTOMATE_ADVANCES.Timekey = RBL_MISDB_PROD.EXT_DATE_MISDB.Timekey 
    WHERE EXTFLAG = 'Y') src
   ON ( RBL_MISDB_PROD.AUTOMATE_ADVANCES.ROWID = src.row_id )
   WHEN MATCHED THEN UPDATE SET EXT_FLG = 'Y';

EXCEPTION WHEN NO_DATA_FOUND THEN DBMS_OUTPUT.PUT_LINE('NO DATA FOUND');
            WHEN OTHERS THEN utils.handleerror(SQLCODE,SQLERRM);
END;

/

  GRANT EXECUTE ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "ROLE_ALL_DB";
  GRANT EXECUTE ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "CC_CDR_RBL_STGDB";
  GRANT EXECUTE ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "MAIN_PRO";
  GRANT EXECUTE ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "RBL_BI_RBL_STGDB";
  GRANT EXECUTE ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "ALERT_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "ACL_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "D2KMNTR_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "QPI_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "CURDAT_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "PREMOC_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "BSG_READ_RBL_STGDB";
  GRANT EXECUTE ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "STD_FIN_RBL_STGDB";
  GRANT EXECUTE ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "BS_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "DWH_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "ETL_TEMP_RBL_TEMPDB";
  GRANT EXECUTE ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "RBL_TEMPDB";
  GRANT EXECUTE ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "ETL_MAIN_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "STG_FIN_RBL_STGDB";
  GRANT EXECUTE ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "DATAUPLOAD_RBL_MISDB_PROD";
  GRANT EXECUTE ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "ADF_CDR_RBL_STGDB";
  GRANT DEBUG ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "ROLE_ALL_DB";
  GRANT DEBUG ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "CC_CDR_RBL_STGDB";
  GRANT DEBUG ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "MAIN_PRO";
  GRANT DEBUG ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "RBL_BI_RBL_STGDB";
  GRANT DEBUG ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "ALERT_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "ACL_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "D2KMNTR_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "QPI_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "CURDAT_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "PREMOC_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "BSG_READ_RBL_STGDB";
  GRANT DEBUG ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "STD_FIN_RBL_STGDB";
  GRANT DEBUG ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "BS_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "DWH_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "ETL_TEMP_RBL_TEMPDB";
  GRANT DEBUG ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "RBL_TEMPDB";
  GRANT DEBUG ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "ETL_MAIN_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "STG_FIN_RBL_STGDB";
  GRANT DEBUG ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "DATAUPLOAD_RBL_MISDB_PROD";
  GRANT DEBUG ON "RBL_STGDB"."UPDATEAUTOMATE_ADVANCES" TO "ADF_CDR_RBL_STGDB";
